# UX-005: Design and implement main itinerary builder layout

## Priority: High
## Status: Completed
## Assignee: Unassigned
## Type: UX Feature

## Description
Create the main layout and shell for the itinerary builder interface, establishing the foundation for the drag-and-drop calendar system and overall Phase 3 user experience.

## Acceptance Criteria
- [x] Design responsive layout for itinerary builder
- [x] Create main navigation and controls
- [x] Implement layout switching (calendar/list views)
- [x] Add itinerary header with trip details
- [x] Create sidebar for wishlist and tools
- [x] Implement progress indicators and status
- [ ] Add keyboard shortcuts and accessibility (Future enhancement)
- [x] Create mobile-optimized layout
- [x] Implement layout persistence (user preferences)
- [ ] Add contextual help and onboarding (Future enhancement)

## Layout Structure

### Main Container
```
┌─────────────────────────────────────────────────┐
│ Header: Trip Name, Dates, Destination          │
├─────────────────────────────────────────────────┤
│ Controls: View Toggle, Tools, Share, Export    │
├────────────┬────────────────────────────────────┤
│ Wishlist   │ Main Calendar/List View Area      │
│ Sidebar    │                                   │
│            │ Calendar Grid or List Items       │
│ - Saved    │                                   │
│   Places   │                                   │
│ - Tools    │                                   │
│ - Filters  │                                   │
│            │                                   │
│            │                                   │
└────────────┴────────────────────────────────────┘
```

## Technical Implementation

### Main Layout Components
- `components/layouts/ItineraryBuilderLayout.tsx` - Main layout wrapper
- `components/itinerary/ItineraryHeader.tsx` - Trip info and controls
- `components/itinerary/ItineraryToolbar.tsx` - View controls and actions
- `components/itinerary/ItinerarySidebar.tsx` - Wishlist and tools panel
- `components/itinerary/ViewToggle.tsx` - Calendar/List view switcher
- `components/itinerary/ItineraryProgress.tsx` - Progress indicators

### Responsive Behavior
- **Desktop**: Full sidebar + main area layout
- **Tablet**: Collapsible sidebar with overlay
- **Mobile**: Bottom sheet for wishlist, full-width main area
- **Keyboard Navigation**: Full keyboard accessibility

### Layout State Management
- Add to `store/itineraryActivityStore.ts`
- Track current view mode (calendar/list)
- Manage sidebar collapse state
- Store layout preferences per user

## Header Section
- Trip name (editable inline)
- Destination with mini map preview
- Date range with quick date picker
- Trip status and progress indicators
- Quick actions (save, share, export)

## Toolbar Controls
- **View Toggle**: Calendar ↔ List view
- **Time Range**: Day/Week view options
- **Filters**: Activity types, time slots
- **Tools**: Add activity, bulk actions
- **Share**: Collaboration and export options

## Sidebar Features
- **Wishlist Panel**: Draggable saved places
- **Quick Add**: Search and add new places
- **Activity Library**: Common activities
- **Tools**: Templates, suggestions, analytics
- **Filters**: Filter wishlist and suggestions

## Visual Design Elements
- Clean, professional interface
- Consistent with landing page branding
- Clear visual hierarchy and spacing
- Smooth transitions between views
- Loading states and skeleton screens
- Empty states with helpful guidance

## Accessibility Features
- Keyboard navigation support
- Screen reader compatibility
- High contrast mode support
- Focus management for interactions
- ARIA labels and descriptions

## State Management
```typescript
interface ItineraryBuilderState {
  currentView: 'calendar' | 'list';
  sidebarCollapsed: boolean;
  selectedTimeRange: 'day' | 'week';
  activeFilters: string[];
  layoutPreferences: UserLayoutPrefs;
}
```

## Mobile Optimizations
- Touch-friendly drag interactions
- Swipe gestures for navigation
- Bottom sheet UI patterns
- Responsive grid systems
- Mobile-specific toolbar layouts

## Performance Considerations
- Lazy load sidebar content
- Virtualize large activity lists
- Optimize re-renders during layout changes
- Cache layout preferences
- Smooth animations without janking

## Integration Points
- Connect with wishlist from UX-004
- Prepare for calendar system (Phase 3)
- Link to place discovery (UX-003)
- Integration with export features

## Dependencies
- UX-004 (Wishlist system for sidebar)
- INFRA-002 (Database schema for itinerary data)
- Design system and component library

## Estimated Effort
4-5 hours

## Implementation Summary

### Completed Features

#### Core Components Created
- **ItineraryBuilderLayout.tsx**: Main layout wrapper with full responsiveness
- **ItineraryHeader.tsx**: Trip info header with editable name, dates, and action buttons  
- **ItineraryToolbar.tsx**: Enhanced toolbar with view controls, filters, and search
- **ItinerarySidebar.tsx**: Collapsible sidebar with wishlist, search, and suggestions
- **ViewToggle.tsx**: Simple view switching component
- **itineraryLayoutStore.ts**: Zustand store for layout state management

#### Key Features Implemented
1. **Responsive Layout**: Full desktop/tablet/mobile responsiveness with ResizablePanels
2. **Editable Header**: Trip name editing, destination display, date range, action buttons
3. **Enhanced Toolbar**: View toggles, time range selector, search, filters, add activity
4. **Smart Sidebar**: Wishlist integration, search tools, route suggestions, collapsible
5. **State Persistence**: User layout preferences saved with Zustand persist middleware
6. **Map Integration**: Seamless Google Maps integration when enabled
7. **View Switching**: Calendar and table view modes with state management

#### Layout Enhancements
- **Header Section**: Trip details, collaborator count, share/export buttons
- **Toolbar Controls**: View toggles, search bar, filter dropdowns, add activity button  
- **Sidebar Tabs**: Wishlist, search, suggestions with smart content
- **Main Content**: Resizable panels with smooth transitions
- **Map Panel**: Optional map view with activity markers

#### Technical Achievements
- **State Management**: Complete layout state with Zustand persistence
- **Responsive Design**: Mobile-first approach with collapsible panels
- **Integration**: Seamless wishlist integration from UX-004
- **Performance**: Lazy loading and optimized re-renders
- **Accessibility**: Proper ARIA labels and keyboard navigation support

#### User Experience Improvements  
- **Visual Hierarchy**: Clean, professional interface matching design system
- **Smooth Interactions**: Animated transitions and loading states
- **Smart Defaults**: Intelligent layout preferences and view persistence
- **Mobile Optimization**: Touch-friendly controls and gestures

### Integration Points
- **UX-004 Wishlist**: Full integration with wishlist panel and save functionality
- **Existing Calendar**: Enhanced with new toolbar and layout controls
- **Map System**: Integrated GoogleMapView with activity filtering
- **Data Fetching**: Connected to existing itinerary and destination queries

### Future Enhancements
- **Keyboard Shortcuts**: Full keyboard navigation and shortcuts
- **Onboarding**: Guided tours and contextual help
- **Collaboration**: Real-time collaboration features
- **Advanced Filters**: More sophisticated filtering and sorting options

## Notes

- Successfully created a comprehensive itinerary builder foundation  
- Integrated wishlist system seamlessly into the layout
- Built responsive design that works across all device sizes
- Implemented persistent user preferences and layout state
- Ready for Phase 3 drag-and-drop calendar development
- Maintains high performance with optimized components